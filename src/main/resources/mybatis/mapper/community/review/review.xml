<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.prj.web.awesome.community.mapper.ReviewMapper">
	<select id="reviewList" resultType="com.prj.web.awesome.community.dto.ReviewDTO">
		select
			review_seq,
			user_id,
			review_title,
			review_content,
			review_reg_date,
			review_rank,
			review_cnt
	    from review
	    order by review_seq desc;
	</select>

	<select id="reviewDetail" resultType="com.prj.web.awesome.community.dto.ReviewDTO">
		select
			attachment_file_seq,
		    user_id,
			review_title,
			review_content,
			review_rank,
			review_reg_date,
			review_seq,
			review_reply
		from review
		where review_seq = #{review_seq};
	</select>

	<insert id="reviewInsert">
		<selectKey keyProperty="review_seq" resultType="int" order="BEFORE"  >
			select IFNULL(max(review_seq),0)+1 from review;
		</selectKey>
		insert into review
		(review_seq,
		attachment_file_seq,
		user_id,
		item_id,
		review_title,
		review_content,
		review_reg_date,
		review_rank
		)
		values(
		#{review_seq},
		"300",
		#{user_id},
		"10000016",
		#{review_title},
		#{review_content},
		now(),
		#{review_rank}
		);
	</insert>

	<update id="qnaUpdate">
		update review set
					review_title = #{review_title},
					review_content = #{review_content}
		where review_seq = #{review_seq};
	</update>

	<delete id="qnaDelete">
		delete
		from review
	</delete>

	<sql id="search">
		<if test="keyword!=null">
			<bind name="keyVal" value="'%'+keyword+'%'"/>
		</if>
		<choose>
			<when test="searchType=='t'.toString()">
				and review_title like #{keyVal} )
			</when>
			<when test="searchType=='i'.toString()">
				and user_id like #{keyVal} )
			</when>
			<when test="searchType=='r'.toString()">
				and review_reg_date like #{keyVal} )
			</when>
			<otherwise> )</otherwise>
		</choose>
	</sql>

	<select id="searchList" resultType="com.prj.web.awesome.community.dto.ReviewDTO">
		select review_seq, user_id, review_title, review_reg_date
		from review
		where ( review_seq>0 <include refid="search"></include>
		limit #{sno}, #{rowsPerPage}
	</select>

	<select id="searchTotalCount" resultType="int">
		select count(*) from review
		where ( review_seq>0 <include refid="search"></include>
	</select>

	<!-- ** Criteria PageList
        => MySql : limit a , b ( a개 제외하고 a+1 부터 b개 )  적용 -->
	<select id="criList" resultType="com.prj.web.awesome.community.dto.ReviewDTO">
		select review_seq, user_id, review_title, review_reg_date, review_rank
		from review
		order by review_seq desc
			limit #{sno}, #{rowsPerPage}
	</select>

</mapper>